javascript:javascript:(function(){ 'use strict'; if (document.getElementById('clickup-task-manager-sidebar')) { document.getElementById('clickup-task-manager-sidebar').remove(); return; } const CONFIG = { workspaceId: null, sessionToken: null, apiBase: 'https: }; const urlMatch = window.location.pathname.match(/\/(\d+)\ if (urlMatch) { CONFIG.workspaceId = urlMatch[1]; } async function getSessionToken() { if (window.__CLICKUP_SESSION_TOKEN) { return window.__CLICKUP_SESSION_TOKEN.replace(/^Bearer\s+/i, ''); } const cookies = document.cookie.split(';'); for (const cookie of cookies) { const [name, value] = cookie.trim().split('='); if (value && value.startsWith('eyJ')) { return decodeURIComponent(value); } } for (let i = 0; i < localStorage.length; i++) { const value = localStorage.getItem(localStorage.key(i)); if (value && value.startsWith('eyJ')) { return value; } } return null; } CONFIG.sessionToken = await getSessionToken(); const sidebar = document.createElement('div'); sidebar.id = 'clickup-task-manager-sidebar'; sidebar.style.cssText = ` position: fixed; top: 0; right: 0; width: 450px; height: 100vh; background: white; z-index: 999999; box-shadow: -2px 0 12px rgba(0,0,0,0.15); overflow-y: auto; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; display: flex; flex-direction: column; `; const header = document.createElement('div'); header.style.cssText = ` padding: 16px 20px; background: #7b68ee; color: white; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; `; header.innerHTML = ` <h2 style="margin: 0; font-size: 18px; font-weight: 600;">ðŸŽ¯ Task Type Manager</h2> <button id="close-sidebar" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; line-height: 30px;">Ã—</button> `; sidebar.appendChild(header); const content = document.createElement('div'); content.id = 'manager-content'; content.style.cssText = 'flex: 1; padding: 20px; overflow-y: auto;'; sidebar.appendChild(content); const tabs = document.createElement('div'); tabs.style.cssText = 'display: flex; border-bottom: 2px solid #e0e0e0; margin: 0 -20px 20px -20px; padding: 0 20px;'; tabs.innerHTML = ` <button class="manager-tab active" data-tab="list" style="padding: 12px 16px; border: none; background: none; cursor: pointer; border-bottom: 2px solid #7b68ee; color: #7b68ee; font-weight: 500;">List</button> <button class="manager-tab" data-tab="create" style="padding: 12px 16px; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent; color: #666; font-weight: 500;">Create</button> <button class="manager-tab" data-tab="csv" style="padding: 12px 16px; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent; color: #666; font-weight: 500;">CSV</button> `; content.appendChild(tabs); const alertContainer = document.createElement('div'); alertContainer.id = 'manager-alerts'; content.appendChild(alertContainer); const listContent = document.createElement('div'); listContent.id = 'tab-list-content'; listContent.className = 'tab-content active'; listContent.innerHTML = '<div class="loading">Loading...</div>'; content.appendChild(listContent); const createContent = document.createElement('div'); createContent.id = 'tab-create-content'; createContent.className = 'tab-content'; createContent.style.display = 'none'; createContent.innerHTML = ` <form id="create-task-form"> <div style="margin-bottom: 16px;"> <label style="display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;">Name (Singular) *</label> <input type="text" id="create-name" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> </div> <div style="margin-bottom: 16px;"> <label style="display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;">Name (Plural) *</label> <input type="text" id="create-name-plural" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> </div> <div style="margin-bottom: 16px;"> <label style="display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;">Description</label> <textarea id="create-description" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; min-height: 80px; resize: vertical;"></textarea> </div> <div style="margin-bottom: 16px;"> <label style="display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;">Icon (Font Awesome)</label> <input type="text" id="create-icon" value="circle" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <small style="color: #666; font-size: 12px;">Preview: <span id="icon-preview">â—‹</span></small> </div> <button type="submit" style="padding: 10px 20px; background: #7b68ee; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">Create</button> </form> `; content.appendChild(createContent); const csvContent = document.createElement('div'); csvContent.id = 'tab-csv-content'; csvContent.className = 'tab-content'; csvContent.style.display = 'none'; csvContent.innerHTML = ` <div style="margin-bottom: 16px;"> <label style="display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;">CSV Data</label> <textarea id="csv-data" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; min-height: 200px; font-family: monospace; resize: vertical;"></textarea> <div style="margin-top: 8px; padding: 12px; background: #f8f9fa; border-radius: 4px; font-size: 12px; font-family: monospace; white-space: pre-wrap;">Example: name,name_plural,description,icon Bug,Bugs,Software defects,bug Feature,Features,New features,rocket</div> </div> <div style="margin-bottom: 16px;"> <label style="display: flex; align-items: center; gap: 8px;"> <input type="checkbox" id="csv-update-existing" checked> <span>Update existing if name matches</span> </label> </div> <button id="csv-import-btn" style="padding: 10px 20px; background: #7b68ee; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">Import CSV</button> `; content.appendChild(csvContent); document.body.appendChild(sidebar); function showAlert(msg, type = 'info') { const alert = document.createElement('div'); alert.style.cssText = ` padding: 12px; margin-bottom: 12px; border-radius: 4px; background: ${type === 'error' ? '#f8d7da' : type === 'success' ? '#d4edda' : '#d1ecf1'}; color: ${type === 'error' ? '#721c24' : type === 'success' ? '#155724' : '#0c5460'}; font-size: 14px; `; alert.textContent = msg; alertContainer.appendChild(alert); setTimeout(() => alert.remove(), 5000); } function switchTab(tabName) { document.querySelectorAll('.manager-tab').forEach(t => { t.style.borderBottomColor = 'transparent'; t.style.color = '#666'; }); document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none'); const activeTab = document.querySelector(`[data-tab="${tabName}"]`); if (activeTab) { activeTab.style.borderBottomColor = '#7b68ee'; activeTab.style.color = '#7b68ee'; } const activeContent = document.getElementById(`tab-${tabName}-content`); if (activeContent) { activeContent.style.display = 'block'; } if (tabName === 'list') { loadTaskTypes(); } } async function loadTaskTypes() { const container = document.getElementById('tab-list-content'); container.innerHTML = '<div class="loading">Loading...</div>'; if (!CONFIG.workspaceId || !CONFIG.sessionToken) { container.innerHTML = '<div style="padding: 20px; color: #721c24;">Error: Workspace ID or session token missing</div>'; return; } try { const response = await fetch(`${CONFIG.apiBase}/${CONFIG.workspaceId}/customItems`, { headers: { 'Authorization': `Bearer ${CONFIG.sessionToken}`, 'Accept': 'application/json, text/plain, */*', 'x-workspace-id': CONFIG.workspaceId, }, credentials: 'include' }); if (!response.ok) throw new Error(`Failed: ${response.status}`); const data = await response.json(); const taskTypes = data.customItems || data.custom_items || data || []; if (taskTypes.length === 0) { container.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">No task types found</div>'; return; } container.innerHTML = ''; taskTypes.forEach(tt => { const card = document.createElement('div'); card.style.cssText = 'padding: 12px; margin-bottom: 8px; border: 1px solid #e0e0e0; border-radius: 4px;'; card.innerHTML = ` <div style="display: flex; justify-content: space-between; align-items: center;"> <div> <strong>${tt.name}</strong> <span style="color: #666; font-size: 12px;">(${tt.avatar_value || 'circle'})</span> <div style="color: #666; font-size: 12px; margin-top: 4px;">${tt.description || 'No description'}</div> </div> <button onclick="window.__UPDATE_TASK_TYPE('${tt.id}')" style="padding: 6px 12px; background: #7b68ee; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Update</button> </div> `; container.appendChild(card); }); } catch (error) { container.innerHTML = `<div style="padding: 20px; color: #721c24;">Error: ${error.message}</div>`; } } window.__UPDATE_TASK_TYPE = async function(taskTypeId) { const name = prompt('Enter new name:'); if (!name) return; const description = prompt('Enter description:'); const icon = prompt('Enter icon name:', 'circle'); try { const response = await fetch(`${CONFIG.apiBase}/${CONFIG.workspaceId}/customItem/${taskTypeId}`, { method: 'PUT', headers: { 'Authorization': `Bearer ${CONFIG.sessionToken}`, 'Content-Type': 'application/json', 'Accept': 'application/json, text/plain, */*', 'x-workspace-id': CONFIG.workspaceId, }, credentials: 'include', body: JSON.stringify({ name: name, name_plural: name + 's', description: description || '', avatar_source: 'fas', avatar_value: icon || 'circle' }) }); if (!response.ok) throw new Error(`Failed: ${response.status}`); showAlert('Updated!', 'success'); loadTaskTypes(); } catch (error) { showAlert(`Error: ${error.message}`, 'error'); } }; document.getElementById('close-sidebar').addEventListener('click', () => sidebar.remove()); document.querySelectorAll('.manager-tab').forEach(tab => { tab.addEventListener('click', () => switchTab(tab.dataset.tab)); }); document.getElementById('create-task-form').addEventListener('submit', async (e) => { e.preventDefault(); const name = document.getElementById('create-name').value.trim(); const namePlural = document.getElementById('create-name-plural').value.trim(); const description = document.getElementById('create-description').value.trim(); const icon = document.getElementById('create-icon').value.trim() || 'circle'; try { const response = await fetch(`${CONFIG.apiBase}/${CONFIG.workspaceId}/customItem`, { method: 'POST', headers: { 'Authorization': `Bearer ${CONFIG.sessionToken}`, 'Content-Type': 'application/json', 'Accept': 'application/json, text/plain, */*', 'x-workspace-id': CONFIG.workspaceId, }, credentials: 'include', body: JSON.stringify({ name: name, name_plural: namePlural, description: description, avatar_source: 'fas', avatar_value: icon }) }); if (!response.ok) throw new Error(`Failed: ${response.status}`); showAlert('Created!', 'success'); document.getElementById('create-task-form').reset(); loadTaskTypes(); } catch (error) { showAlert(`Error: ${error.message}`, 'error'); } }); document.getElementById('csv-import-btn').addEventListener('click', async () => { const csvData = document.getElementById('csv-data').value.trim(); if (!csvData) { showAlert('Please paste CSV data', 'error'); return; } const lines = csvData.trim().split('\n'); const headers = lines[0].split(',').map(h => h.trim()); const rows = []; for (let i = 1; i < lines.length; i++) { const values = lines[i].split(',').map(v => v.trim()); const row = {}; headers.forEach((h, idx) => row[h] = values[idx] || ''); rows.push(row); } let success = 0; for (const row of rows) { try { const response = await fetch(`${CONFIG.apiBase}/${CONFIG.workspaceId}/customItem`, { method: 'POST', headers: { 'Authorization': `Bearer ${CONFIG.sessionToken}`, 'Content-Type': 'application/json', 'Accept': 'application/json, text/plain, */*', 'x-workspace-id': CONFIG.workspaceId, }, credentials: 'include', body: JSON.stringify({ name: row.name || row.Name || '', name_plural: row.name_plural || row['name_plural'] || row.Name_Plural || (row.name || row.Name) + 's', description: row.description || row.Description || '', avatar_source: 'fas', avatar_value: row.icon || row.Icon || 'circle' }) }); if (response.ok) success++; await new Promise(r => setTimeout(r, 300)); } catch (e) {} } showAlert(`Imported ${success} of ${rows.length}`, success > 0 ? 'success' : 'error'); loadTaskTypes(); }); document.getElementById('create-icon').addEventListener('input', (e) => { const icon = e.target.value.trim() || 'circle'; document.getElementById('icon-preview').textContent = icon; }); loadTaskTypes(); })();